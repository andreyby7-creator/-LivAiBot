#!/usr/bin/env bash
# Pre-push hook for comprehensive quality checks
# Runs more expensive checks before pushing to remote

set -e

echo "ğŸš€ Running pre-push checks..."

# 1. Run full type check on all packages
echo "  ğŸ” Type checking all packages..."
pnpm run type-check || {
  echo "  âŒ Type check failed"
  exit 1
}

# 2. Run full lint on changed files
echo "  ğŸ“ Linting changed files..."
pnpm run lint || {
  echo "  âŒ Lint failed"
  exit 1
}

# 3. Run tests on changed packages
echo "  ğŸ§ª Running tests on changed packages..."
pnpm run test || {
  echo "  âŒ Tests failed"
  exit 1
}

# 4. Validate architecture boundaries
echo "  ğŸ›ï¸  Validating architecture boundaries..."
pnpm run architecture:validate || {
  echo "  âŒ Architecture validation failed"
  exit 1
}

echo "  ğŸ§± Verifying infrastructure core..."
pnpm run verify:infra || {
  echo "  âŒ Infra verification failed"
  exit 1
}

# 5. Check for security issues (optional)
# echo "  ğŸ”’ Checking for security issues..."
# pnpm run security:audit || {
#   echo "  âš ï¸  Security issues found (continuing)"
# }

echo "âœ… Pre-push checks passed!"

