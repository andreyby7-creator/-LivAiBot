#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# @ts-check
# Commit message hook for SaleSpot BY
# This hook validates commit message format

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Get commit message
commit_message=$(cat "$1")

log_info "Validating commit message..."

# Commit message format: type(scope): description
# Types: feat, fix, docs, style, refactor, test, chore
# Examples:
# - feat(api): add user authentication endpoint
# - fix(web): resolve mobile responsive issues
# - docs(readme): update installation instructions

# Check if commit message matches the required format
if echo "$commit_message" | grep -qE '^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+'; then
    log_success "Commit message format is valid"
else
    log_error "Invalid commit message format"
    echo ""
    echo "Expected format: type(scope): description"
    echo ""
    echo "Types:"
    echo "  feat     - A new feature"
    echo "  fix      - A bug fix"
    echo "  docs     - Documentation only changes"
    echo "  style    - Changes that do not affect the meaning of the code"
    echo "  refactor - A code change that neither fixes a bug nor adds a feature"
    echo "  test     - Adding missing tests or correcting existing tests"
    echo "  chore    - Changes to the build process or auxiliary tools"
    echo ""
    echo "Examples:"
    echo "  feat(api): add user authentication endpoint"
    echo "  fix(web): resolve mobile responsive issues"
    echo "  docs(readme): update installation instructions"
    echo "  chore(deps): update dependencies"
    echo ""
    echo "Your commit message:"
    echo "  $commit_message"
    echo ""
    exit 1
fi

# Check commit message length
if [[ ${#commit_message} -gt 100 ]]; then
    log_warning "Commit message is longer than 100 characters"
    log_info "Consider using a shorter description"
fi

# Check for common mistakes
if echo "$commit_message" | grep -qi "wip\|work in progress\|todo\|fixme"; then
    log_warning "Commit message contains WIP/TODO/FIXME keywords"
    log_info "Consider using 'chore' type for work-in-progress commits"
fi

log_success "Commit message validation passed! âœ…"
