[tool:pytest]
# Базовая конфигурация pytest для LivAi Python сервисов

# Отчетность и опции
addopts =
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --cov=services
    --cov-report=term-missing
    --cov-report=html:reports/coverage/python
    --cov-report=json:reports/coverage/python.json
    --cov-fail-under=80

# Маркеры для разных типов тестов
markers =
    unit: Unit тесты (быстрые, без внешних зависимостей)
    integration: Интеграционные тесты (с БД, внешними API)
    ai: Тесты с AI провайдерами (дорогие, с ограничениями)
    e2e: End-to-end тесты
    slow: Медленные тесты (пропускать в CI по умолчанию)
    flaky: Нестабильные тесты (с повторными попытками)

# Таймауты
timeout = 300
timeout_method = thread

# Параллелизация
# numprocesses = auto  # Раскомментировать для параллельного запуска

# Фильтры путей и имен
testpaths = services
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*
python_package = True

# CI конфигурация: пропускать медленные и AI тесты по умолчанию
# Для запуска всех тестов: pytest -m "not (slow or ai)"
# markers = not slow and not ai