[mypy]
python_version = 3.13
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = False
no_implicit_optional = True
check_untyped_defs = True
mypy_path = services/auth-service/auth_src:services/bots-service/bots_src:services/conversations-service/conversations_src:services/api-gateway/api_src

# ==========================
# Политика Any (фиксируем “один раз”)
# ==========================
#
# Any разрешён ТОЛЬКО:
# - на входе/выходе системы (entrypoints)
# - в infra/adapters/middleware/security/errors
#
# Внутри домена (domain) и слоя use_cases — запрещён.
#
disallow_any_expr = True
disallow_any_generics = True
disallow_any_unimported = True

[mypy-asyncpg.*]
ignore_missing_imports = True

[mypy-clickhouse_connect.*]
ignore_missing_imports = True

# ==========================
# Послабления на границе/инфре
# ==========================
[mypy-api_src.entrypoints.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-bots_src.entrypoints.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-conversations_src.entrypoints.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-auth_src.entrypoints.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-api_src.main]
# `api_src.main` — точка входа (boundary), здесь допустим Any из request.state и внешних библиотек.
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-bots_src.main]
# `bots_src.main` — точка входа (boundary), здесь допустим Any из request.state и внешних библиотек.
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-conversations_src.main]
# `conversations_src.main` — точка входа (boundary), здесь допустим Any из request.state и внешних библиотек.
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-auth_src.main]
# `auth_src.main` — точка входа (boundary), здесь допустим Any из request.state и внешних библиотек.
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-*.adapters.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-*.middleware.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-*.security.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

[mypy-*.errors.*]
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = False
warn_return_any = False

# ==========================
# Ядро (строго)
# ==========================
[mypy-*.domain.*]
disallow_any_expr = True
disallow_any_generics = True
disallow_any_unimported = True
warn_return_any = True

[mypy-*.use_cases.*]
# Use cases могут содержать SQLAlchemy код с Any типами
disallow_any_expr = False
disallow_any_generics = False
disallow_any_unimported = True
warn_return_any = False

