# ğŸ” Login Effect Refactoring Strategy

**ğŸ“… Ğ”Ğ°Ñ‚Ğ°:** 2026-01\
**ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ñ€ĞµÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ\
**ğŸ”´ ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹\
**ğŸ¯ Ğ¦ĞµĞ»ÑŒ:** Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¸Ñ‚ `login.ts` Ğ¸ Ğ²Ğ½ĞµĞ´Ñ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… `feature-*`

---

## 0ï¸âƒ£ ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ (ĞšĞĞĞ¦Ğ•ĞĞ¢Ğ Ğ˜Ğ ĞĞ’ĞĞĞĞ)

### ğŸ“„ Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ `login.ts`

- **ğŸ“ 1800+ ÑÑ‚Ñ€Ğ¾Ğº** Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğµ
- **ğŸ”€ 6+ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ¾Ğ²** Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğµ
- **â±ï¸ Inline timeout** â€” Ğ½ĞµÑ‚ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ°
- **âœ… Inline validation** â€” Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- **ğŸ›¡ï¸ Inline risk** â€” ÑĞ¼ĞµÑˆĞ°Ğ½Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ
- **ğŸ“Š Inline telemetry** â€” Ğ½ĞµÑ‚ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- **âŒ Inline error mapping** â€” Ñ…Ñ€ÑƒĞ¿ĞºĞ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
- **ğŸ’¥ ĞšĞ°ÑĞºĞ°Ğ´Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸** â€” Ğ½ĞµÑ‚ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸
- **âš ï¸ ESLint AI warnings** â€” Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ best practices

### ğŸ“‹ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹

| ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°                 | ĞŸĞ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ğµ          | ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ |
| ------------------------ | -------------------- | ----------- |
| âŒ ĞĞµÑ‚ timeout           | Hanging effects      | ğŸ”´ Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ  |
| âŒ ĞĞµÑ‚ isolation         | Cascading failures   | ğŸ”´ Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ  |
| âŒ ĞĞµÑ‚ schema validation | Model poisoning      | ğŸ”´ Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ  |
| âŒ SRP Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½           | ĞĞ¸Ğ·ĞºĞ°Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ | ğŸŸ¡ Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ  |
| âŒ Ğ”ÑƒĞ±Ğ»Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸          | Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´Ğ¾Ğ»Ğ³     | ğŸŸ¡ Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ  |

---

## 1ï¸âƒ£ Ğ¦Ğ•Ğ›Ğ•Ğ’ĞĞ¯ ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ (Ğ¡Ğ¢ĞĞĞ”ĞĞ Ğ¢ Ğ”Ğ›Ğ¯ Ğ’Ğ¡Ğ•Ğ¥ EFFECTS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI Layer                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Hooks Layer                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Effect (thin orchestration)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Orchestrator                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Isolated Step                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚      Timeout                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Validated Schema     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  API Client     â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Store Layer                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

- âœ… **ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ step Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½** â€” Ğ½ĞµÑ‚ ĞºĞ°ÑĞºĞ°Ğ´Ğ½Ñ‹Ñ… Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¹
- âœ… **Timeout Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½** â€” Ğ½ĞµÑ‚ hanging effects
- âœ… **Runtime schema validation** â€” Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ model poisoning
- âœ… **ĞĞµÑ‚ ĞºĞ°ÑĞºĞ°Ğ´Ğ½Ñ‹Ñ… Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¹** â€” Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ step
- âœ… **ESLint AI rules = 0 warnings** â€” ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ°Ğ¼
- âœ… **Reusable Ğ´Ğ»Ñ Ğ²ÑĞµÑ… feature-*** â€” ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½

### ğŸ“ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾: Consistency Ğ² Naming

**Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… `feature-*`:**

**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:** `Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ + Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:**

- âœ… `executeSecurityPipeline` â€” Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ security pipeline
- âœ… `assessLoginRisk` â€” Ğ¾Ñ†ĞµĞ½ĞºĞ° login risk
- âœ… `getDeviceFingerprint` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ device fingerprint
- âœ… `mapAuthError` â€” Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ auth error
- âœ… `generateTraceId` â€” Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ trace ID
- âœ… `buildLoginMetadata` â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ login metadata

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°:**

- âœ… **Ğ“Ğ»Ğ°Ğ³Ğ¾Ğ» + Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ** â€” Ñ‡ĞµÑ‚ĞºĞ¾Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°
- âœ… **CamelCase** â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ Ğ´Ğ»Ñ TypeScript
- âœ… **Ğ•Ğ´Ğ¸Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ğµ** â€” Ğ²ÑĞµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ² feature ÑĞ»ĞµĞ´ÑƒÑÑ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ
- âŒ **Ğ˜Ğ·Ğ±ĞµĞ³Ğ°Ñ‚ÑŒ** â€” Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ‚Ğ½Ñ‹Ñ… Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ±ĞµĞ· Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ (`process`, `handle`, `do`)

**Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ:**

- Type guards: `isValidLoginRequest` (is + Ğ¿Ñ€Ğ¸Ğ»Ğ°Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ + ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ)
- Type constructors: `createValidationError` (create + ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ)

---

### 1ï¸âƒ£6ï¸âƒ£1ï¸âƒ£ `error-mapper.ts` (NEW)

**ğŸ“ Path:** `packages/feature-auth/src/effects/login/error-mapper.ts`\
**ğŸ”§ Ğ¢Ğ¸Ğ¿:** `ts`\
**ğŸ“¦ Deps:** `app/lib/error-mapping.ts`, `domain/AuthErrorResponse.ts`, `types/auth.ts`

#### ğŸ¯ ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ

Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ API Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ² UI-friendly AuthError Ğ±ĞµĞ· side-effects.

#### ğŸ“¦ Ğ­Ñ‚Ğ°Ğ»Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ (FAANG-ready)

**1ï¸âƒ£ `mapAuthError`** â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ API (error: AuthErrorResponse | DomainError): AuthError

#### âœ… Ğ§Ñ‚Ğ¾ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚

- ğŸ”„ **Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº** â€” API Error â†’ DomainError â†’ UI AuthError
- ğŸ¯ **Ğ¢Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ mapping** â€” ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ error codes

#### âŒ Ğ§Ñ‚Ğ¾ ĞĞ• Ğ´ĞµĞ»Ğ°ĞµÑ‚ (Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ SRP)

- âŒ **Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°** â†’ business logic layer
- âŒ **Error handling** â†’ error-handling layer
- âŒ **Telemetry** â†’ observability layer
- âŒ **Store updates** â†’ store layer

#### ğŸ“‹ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°

- âœ… **Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ** â€” Ğ±ĞµĞ· Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- âœ… **ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ** â€” logout, refresh, OAuth, MFA
- âœ… **Ğ‘ĞµĞ· side-effects** â€” Ñ‡Ğ¸ÑÑ‚Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ

---

### 1ï¸âƒ£6ï¸âƒ£2ï¸âƒ£ `helpers.ts` (NEW)

**ğŸ“ Path:** `packages/feature-auth/src/effects/login/helpers.ts`\
**ğŸ”§ Ğ¢Ğ¸Ğ¿:** `ts`\
**ğŸ“¦ Deps:** `types/auth.ts`

#### ğŸ¯ ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ

Ğ§Ğ¸ÑÑ‚Ñ‹Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ±ĞµĞ· side-effects Ğ´Ğ»Ñ login effect.

#### ğŸ“¦ Ğ­Ñ‚Ğ°Ğ»Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ (FAANG-ready)

**1ï¸âƒ£ `generateTraceId`** â€” Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ trace ID (prefix?: string): string\
**2ï¸âƒ£ `isValidLoginRequest`** â€” type guard Ğ´Ğ»Ñ login request (value: unknown): value is LoginRequest\
**3ï¸âƒ£ `buildLoginMetadata`** â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (context: LoginContext): LoginMetadata

#### âœ… Ğ§Ñ‚Ğ¾ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚

- ğŸ” **Type guards** â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¸Ğ¿Ğ¾Ğ²
- ğŸ†” **Trace ID generation** â€” ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹
- ğŸ“Š **Metadata builders** â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

#### âŒ Ğ§Ñ‚Ğ¾ ĞĞ• Ğ´ĞµĞ»Ğ°ĞµÑ‚ (Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ SRP)

- âŒ **Business logic** â†’ business logic layer
- âŒ **API calls** â†’ api-client layer
- âŒ **Store operations** â†’ store layer
- âŒ **Telemetry** â†’ observability layer

#### ğŸ“‹ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°

- âœ… **Ğ‘ĞµĞ· side-effects** â€” Ñ‡Ğ¸ÑÑ‚Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
- âœ… **Pure utilities** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸

---

### 1ï¸âƒ£6ï¸âƒ£3ï¸âƒ£ `security-pipeline.ts` (NEW)

**ğŸ“ Path:** `packages/feature-auth/src/lib/security-pipeline.ts`\
**ğŸ”§ Ğ¢Ğ¸Ğ¿:** `ts+effect`\
**ğŸ“¦ Deps:** `effects/login/device-fingerprint.ts`, `effects/login/risk-assessment.ts`, `app/lib/orchestrator.ts`, `types/auth.ts`

#### ğŸ¯ ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ

ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ security flow Ñ‡ĞµÑ€ĞµĞ· orchestrator: fingerprint â†’ risk assessment Ñ isolation Ğ¸ timeout.

#### ğŸ“¦ Ğ­Ñ‚Ğ°Ğ»Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ (FAANG-ready)

**1ï¸âƒ£ `executeSecurityPipeline`** â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ API (context: SecurityContext): Effect<SecurityResult>

#### âœ… Ğ§Ñ‚Ğ¾ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚

- ğŸ” **Security flow** â€” fingerprint â†’ risk assessment
- ğŸ”’ **Isolation** â€” Ñ‡ĞµÑ€ĞµĞ· orchestrator (runIsolated)
- â±ï¸ **Timeout** â€” Ñ‡ĞµÑ€ĞµĞ· orchestrator (withTimeout)
- âœ… **Ğ¢Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚** â€” SecurityResult Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ‡ĞµÑ€ĞµĞ· validatedEffect (ĞµÑĞ»Ğ¸ Ğ²Ğ¾Ğ²Ğ»ĞµÑ‡ĞµĞ½Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚ api-client)

#### âš ï¸ Ğ’Ğ°Ğ¶Ğ½Ğ¾: Ğ¢Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°

**SecurityResult Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½:**

- âœ… **Ğ§ĞµÑ€ĞµĞ· validatedEffect** â€” ĞµÑĞ»Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚ api-client
- âœ… **Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** â€” Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚ Zod Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
- âœ… **Runtime type safety** â€” Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

#### âŒ Ğ§Ñ‚Ğ¾ ĞĞ• Ğ´ĞµĞ»Ğ°ĞµÑ‚ (Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ SRP)

- âŒ **Isolation implementation** â†’ effect-isolation layer
- âŒ **Timeout implementation** â†’ effect-timeout layer
- âŒ **Orchestration implementation** â†’ orchestrator
- âŒ **Device fingerprinting** â†’ device-fingerprint.ts
- âŒ **Risk calculation** â†’ risk-assessment.ts

#### ğŸ”„ Reusable Ğ´Ğ»Ñ

- ğŸ” OAuth login
- ğŸ“ Register
- ğŸ”’ MFA
- ğŸ”„ Session refresh

---

### 1ï¸âƒ£6ï¸âƒ£5ï¸âƒ£ `login.ts` (REWRITE)

**ğŸ“ Path:** `packages/feature-auth/src/effects/login.ts`\
**ğŸ”§ Ğ¢Ğ¸Ğ¿:** `ts+effect`\
**ğŸ“¦ Deps:** `app/lib/orchestrator.ts`, `app/lib/schema-validated-effect.ts`, `lib/security-pipeline.ts`, `effects/login/error-mapper.ts`, `effects/login/helpers.ts`, `stores/auth.ts`, `types/auth.ts`, `domain/*`, `schemas.ts`

#### âœ… Ğ¢ĞµĞ¿ĞµÑ€ÑŒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ

- ğŸ¼ **Orchestration** â€” ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ÑˆĞ°Ğ³Ğ¾Ğ²
- âœ… **Validated API call** â€” Ñ‡ĞµÑ€ĞµĞ· validatedEffect
- ğŸ’¾ **Store update** â€” Ñ‡ĞµÑ€ĞµĞ· safeSet

#### âŒ ĞĞµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚

- âŒ Fingerprint logic â†’ Ğ²Ñ‹Ğ½ĞµÑĞµĞ½Ğ¾ Ğ² `device-fingerprint.ts`
- âŒ Risk logic â†’ Ğ²Ñ‹Ğ½ĞµÑĞµĞ½Ğ¾ Ğ² `risk-assessment.ts`
- âŒ Timeout â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `withTimeout`
- âŒ Validation â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `validatedEffect`
- âŒ try/catch â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `runIsolated`
- âŒ Retry â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `withRetry` Ğ¸Ğ· effect-utils

#### ğŸ“ Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€

**~300 ÑÑ‚Ñ€Ğ¾Ğº** (Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 1800+)

---

## 4ï¸âƒ£ PHASE 3 â€” ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ”Ğ Ğ£Ğ“Ğ˜Ğ¥ EFFECTS

> ğŸ’¡ **ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:** ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ ĞºĞ¾ Ğ²ÑĞµĞ¼ effects.

### 1ï¸âƒ£6ï¸âƒ£7ï¸âƒ£ `refresh.ts` (UPDATE)

**ğŸ“ Path:** `packages/feature-auth/src/effects/refresh.ts`

#### â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ

- â±ï¸ `withTimeout` â€” Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ timeout
- ğŸ”’ `isolation` â€” Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- âœ… `validatedEffect` â€” schema validation

---

### 1ï¸âƒ£7ï¸âƒ£6ï¸âƒ£ `createBot.ts` (UPDATE)

**ğŸ“ Path:** `packages/feature-bots/src/effects/createBot.ts`

#### â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ

- ğŸ”’ `isolation` â€” Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- â±ï¸ `timeout` â€” Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ timeout
- âœ… `schema validation` â€” Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° API

---

### 1ï¸âƒ£8ï¸âƒ£5ï¸âƒ£ `sendMessage.ts` (UPDATE)

**ğŸ“ Path:** `packages/feature-chat/src/effects/sendMessage.ts`

#### â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ

- âœ… `validatedEffect` â€” schema validation
- ğŸ”’ `isolation` â€” Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- â±ï¸ `timeout` â€” Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ timeout
- ğŸ”„ `idempotency guard` â€” Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²

---

---

## 6ï¸âƒ£ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢

### ğŸ“Š Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ°           | Ğ”Ğ¾          | ĞŸĞ¾ÑĞ»Ğµ      | Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ |
| ----------------- | ----------- | ---------- | --------- |
| ğŸ“ `login.ts`     | 1800+ ÑÑ‚Ñ€Ğ¾Ğº | ~300 ÑÑ‚Ñ€Ğ¾Ğº | **-83%**  |
| âš ï¸ AI warnings     | 4+          | 0          | **-100%** |
| â±ï¸ Timeout         | Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾    | 100%       | **+100%** |
| ğŸ”’ Isolation      | ĞĞµÑ‚         | 100%       | **+100%** |
| âœ… Validation     | Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾    | 100%       | **+100%** |
| ğŸ”„ Reusable infra | ĞĞµÑ‚         | Ğ”Ğ°         | **+100%** |

### âœ… ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

- âœ… **ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ reusable** Ğ´Ğ»Ñ Ğ²ÑĞµÑ… `feature-*`
- âœ… **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ enforced** Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ `app/lib`
- âœ… **ESLint AI rules satisfied** â€” 0 warnings
- âœ… **ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ°Ñ** â€” Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ effects
- âœ… **SSR-safe** â€” Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ´Ğ»Ñ SSR
- âœ… **ĞĞµÑ‚ hydration waterfall** â€” Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°
- âœ… **ĞĞµÑ‚ ĞºĞ°ÑĞºĞ°Ğ´Ğ½Ñ‹Ñ… Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¹** â€” Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ½Ğ° Ğ²ÑĞµÑ… ÑƒÑ€Ğ¾Ğ²Ğ½ÑÑ…
- âœ… **ĞĞµÑ‚ hanging effects** â€” timeout Ğ²ĞµĞ·Ğ´Ğµ

---

## 7ï¸âƒ£ ĞŸĞĞ Ğ¯Ğ”ĞĞš Ğ’ĞĞ•Ğ”Ğ Ğ•ĞĞ˜Ğ¯ (Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞŸĞ Ğ­Ğ¢ĞĞŸĞĞœ)

### ğŸ“‹ Ğ­Ğ¢ĞĞŸ 1 â€” Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

> ğŸ¯ **Ğ¦ĞµĞ»ÑŒ:** ĞŸĞ¾ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½Ğ´Ğ°Ğ¼ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… effects

1. âœ… **6ï¸âƒ£7ï¸âƒ£** `effect-timeout.ts` â€” ĞµĞ´Ğ¸Ğ½Ğ°Ñ Ğ¾Ğ±Ñ‘Ñ€Ñ‚ĞºĞ° timeout
2. âœ… **6ï¸âƒ£8ï¸âƒ£** `effect-isolation.ts` â€” Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²
3. âœ… **6ï¸âƒ£9ï¸âƒ£** `schema-validated-effect.ts` â€” Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
4. âœ… **7ï¸âƒ£0ï¸âƒ£** `orchestrator.ts` â€” composable pipeline
5. âœ… **7ï¸âƒ£1ï¸âƒ£** `store-utils.ts` â€” Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ store

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:** Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹, ESLint = 0 warnings

---

### ğŸ“‹ Ğ­Ğ¢ĞĞŸ 2 â€” Feature-Auth

> ğŸ¯ **Ğ¦ĞµĞ»ÑŒ:** Ğ Ğ°Ğ·Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¸Ñ‚ `login.ts`

1. âœ… **1ï¸âƒ£5ï¸âƒ£5ï¸âƒ£.1ï¸âƒ£** `device-fingerprint.ts` â€” Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹ fingerprint
2. âœ… **1ï¸âƒ£5ï¸âƒ£5ï¸âƒ£.2ï¸âƒ£** `risk-assessment.ts` â€” Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹ risk
3. âœ… **1ï¸âƒ£5ï¸âƒ£5ï¸âƒ£.3ï¸âƒ£** `error-mapper.ts` â€” auth error mapping
4. âœ… **1ï¸âƒ£5ï¸âƒ£5ï¸âƒ£.4ï¸âƒ£** `helpers.ts` â€” Ñ‡Ğ¸ÑÑ‚Ñ‹Ğµ helpers
5. âœ… **1ï¸âƒ£5ï¸âƒ£8ï¸âƒ£.1ï¸âƒ£** `security-pipeline.ts` â€” reusable security
6. âœ… **1ï¸âƒ£5ï¸âƒ£5ï¸âƒ£** `login.ts` rewrite â€” Ñ‡ĞµÑ€ĞµĞ· orchestrator

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:** `login.ts` = ~300 ÑÑ‚Ñ€Ğ¾Ğº, Ğ²ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚

---

### ğŸ“‹ Ğ­Ğ¢ĞĞŸ 3 â€” ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ effects

> ğŸ¯ **Ğ¦ĞµĞ»ÑŒ:** ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ ĞºĞ¾ Ğ²ÑĞµĞ¼ effects

1. âœ… **1ï¸âƒ£5ï¸âƒ£7ï¸âƒ£** `refresh.ts` â€” timeout + isolation + validation
2. âœ… **1ï¸âƒ£6ï¸âƒ£6ï¸âƒ£** `createBot.ts` â€” timeout + isolation + validation
3. âœ… **1ï¸âƒ£7ï¸âƒ£5ï¸âƒ£** `sendMessage.ts` â€” timeout + isolation + validation + idempotency

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:** Ğ’ÑĞµ effects Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚

---

### ğŸ“‹ Ğ­Ğ¢ĞĞŸ 4 â€” Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ

> ğŸ¯ **Ğ¦ĞµĞ»ÑŒ:** Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ Ğ²ÑÑ‘ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

1. âœ… **Unit tests** â€” Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
2. âœ… **Integration tests** â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° login flow
3. âœ… **ESLint = 0 warnings** â€” ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ°Ğ¼
4. âœ… **TS strict pass** â€” Ñ‚Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:** Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ñ‹

---

### ğŸ“‹ Ğ­Ğ¢ĞĞŸ 5 â€” ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

> ğŸ¯ **Ğ¦ĞµĞ»ÑŒ:** Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€ÑƒÑ ÑĞ²ÑĞ·Ğ½Ğ¾ÑÑ‚ÑŒ, Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ AI-warnings, Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

> âš ï¸ **ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾:** ĞŸĞ¾ÑĞ»Ğµ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸Ñ `orchestrator` + `validatedEffect` + `isolation` + `timeout` Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ² ÑÑ‚Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ… **ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ** Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾:**

- âŒ Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ¾ÑÑ‚Ğ°Ğ½ĞµÑ‚ÑÑ **ÑÑ‚Ğ°Ñ€Ğ°Ñ ÑĞ²ÑĞ·Ğ½Ğ¾ÑÑ‚ÑŒ**
- âŒ Ğ§Ğ°ÑÑ‚ÑŒ **AI-warnings Ğ²ĞµÑ€Ğ½Ñ‘Ñ‚ÑÑ**
- âŒ **Orchestration Ğ±ÑƒĞ´ĞµÑ‚ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ**
- âŒ **app-layer Ğ½Ğµ ÑÑ‚Ğ°Ğ½ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ¾Ğ¹**

---

#### 1ï¸âƒ£5ï¸âƒ£5ï¸âƒ£ `login.ts` (DEPENDENCIES UPDATE)

**ğŸ“ Path:** `packages/feature-auth/src/effects/login.ts`

**âŒ Ğ‘Ñ‹Ğ»Ğ¾:**

```typescript
deps:
  app/lib/api-client.ts
  app/lib/error-mapping.ts
  app/lib/telemetry.ts
  stores/auth.ts
  domain/*
```

**âœ… Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑÑ‚Ğ°Ñ‚ÑŒ:**

```typescript
deps:
  app/lib/orchestrator.ts
  app/lib/schema-validated-effect.ts
  app/lib/effect-timeout.ts
  app/lib/effect-isolation.ts
  lib/security-pipeline.ts
  effects/login/error-mapper.ts
  effects/login/helpers.ts
  stores/auth.ts
  types/auth.ts
  domain/*
  schemas.ts (LoginApiResponse schema)
```

**âŒ Ğ§Ñ‚Ğ¾ ÑƒĞ±Ñ€Ğ°Ñ‚ÑŒ:**

- âŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ `api-client` â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `orchestrator`
- âŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ `telemetry.log` â†’ telemetry Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `orchestrator` Ğ¸ `validatedEffect`
- âŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ `error-mapping` â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `error-mapper.ts` Ğ¸ `validatedEffect`

**ğŸ’¡ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ?**
Ğ¢ĞµĞ¿ĞµÑ€ÑŒ `login` â€” ÑÑ‚Ğ¾ **use-case orchestration**, Ğ° Ğ½Ğµ transport-ÑĞ»Ğ¾Ğ¹. Transport Ğ¸ telemetry Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¶Ğ¸Ñ‚ÑŒ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸:

- `orchestrator` â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `api-client` Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ (login Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ transport)
- `validatedEffect` â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `api-schema-guard` Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ (login Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ validation Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸)
- `error-mapper.ts` â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `error-mapping` Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ (login Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ error mapping Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸)

**âš ï¸ Ğ˜Ğ½Ğ°Ñ‡Ğµ:**

- Ğ”Ğ²Ğ¾Ğ¹Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ñ‹ (orchestrator + inline)
- Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ (orchestrator + inline try/catch)
- Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ ESLint AI warnings (Ğ½Ğµ Ğ²ÑĞµ Ğ¿ÑƒÑ‚Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹)

---

#### 1ï¸âƒ£5ï¸âƒ£6ï¸âƒ£ `logout.ts` (DEPENDENCIES UPDATE)

**ğŸ“ Path:** `packages/feature-auth/src/effects/logout.ts`

**âŒ Ğ‘Ñ‹Ğ»Ğ¾:**

```typescript
deps:
api - client;
telemetry;
store;
```

**âœ… Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑÑ‚Ğ°Ñ‚ÑŒ:**

```typescript
deps:
  app/lib/orchestrator.ts
  app/lib/schema-validated-effect.ts (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ response)
  stores/auth.ts
```

**ğŸ’¡ Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
Logout â€” ÑÑ‚Ğ¾ **single-step orchestration:**

```
runIsolated â†’ withTimeout â†’ safeSet
```

**âŒ Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ:**

- âŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ `api-client` â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `orchestrator`
- âŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ `telemetry` â†’ telemetry Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `orchestrator`

---

#### 1ï¸âƒ£5ï¸âƒ£7ï¸âƒ£ `refresh.ts` (DEPENDENCIES UPDATE)

**ğŸ“ Path:** `packages/feature-auth/src/effects/refresh.ts`

**âŒ Ğ‘Ñ‹Ğ»Ğ¾:**

```typescript
deps:
api - client;
telemetry;
types;
store;
AuthPolicy;
```

**âœ… Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑÑ‚Ğ°Ñ‚ÑŒ:**

```typescript
deps:
app / lib / orchestrator.ts;
app / lib / schema - validated - effect.ts;
stores / auth.ts;
types / auth.ts;
core / domain / AuthPolicy;
```

**âŒ Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ:**

- âŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ `api-client` â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `orchestrator`
- âŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ `telemetry` â†’ telemetry Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `orchestrator` Ğ¸ `validatedEffect`

**âš ï¸ ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ²Ğ°Ğ¶ĞµĞ½, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾:**

- Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ `session-manager`
- ĞœĞ¾Ğ¶ĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑŒÑÑ **Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾**
- ĞœĞ¾Ğ¶ĞµÑ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ **cascading failure**

**âœ… ĞŸĞ¾ÑÑ‚Ğ¾Ğ¼Ñƒ ĞĞ‘Ğ¯Ğ—ĞĞ Ğ¸Ğ´Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ·:**

- `runIsolated` â†’ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº (Ñ‡ĞµÑ€ĞµĞ· orchestrator)
- `withTimeout` â†’ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ timeout (Ñ‡ĞµÑ€ĞµĞ· orchestrator)
- `idempotency guard` â†’ **ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ** Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²

#### âš ï¸ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾: Idempotency Guard

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**

- `session-manager` Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ `refresh` Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾
- ĞĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… refresh â†’ Ğ³Ğ¾Ğ½ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹
- ĞœĞ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ°ÑĞºĞ°Ğ´Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**

```typescript
// Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ refresh.ts Ñ‡ĞµÑ€ĞµĞ· orchestrator
orchestrate([
  step('idempotency-check', checkIfAlreadyRefreshing),
  step('refresh-api', refreshApiCall),
  step('update-store', updateStore),
]);
```

**Ğ˜Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· mutex (ĞµÑĞ»Ğ¸ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ Ğ² auth-service):**

- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ `refreshMutex` Ğ¸Ğ· `auth-service.ts`
- ĞĞ±ĞµÑ€Ğ½ÑƒÑ‚ÑŒ refresh effect Ğ² mutex guard
- Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ effect

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:**

- ĞĞµÑ‚ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… refresh Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
- ĞĞµÑ‚ Ğ³Ğ¾Ğ½ĞºĞ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹
- ĞĞµÑ‚ ĞºĞ°ÑĞºĞ°Ğ´Ğ½Ñ‹Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¿Ñ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… refresh

---

#### 1ï¸âƒ£5ï¸âƒ£8ï¸âƒ£ `session-manager.ts` (DEPENDENCIES UPDATE)

**ğŸ“ Path:** `packages/feature-auth/src/lib/session-manager.ts`

> âš ï¸ **â— Ğ­Ñ‚Ğ¾ ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚**

**session-manager ĞĞ• Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ·Ğ°Ğ²Ğ¸ÑĞµÑ‚ÑŒ Ğ¾Ñ‚ orchestrator**

**âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ:**

```typescript
deps:
effects / refresh.ts;
types / auth.ts;
core / domain / AuthPolicy;
domain / SessionPolicy.ts;
```

**âŒ ĞĞµĞ»ÑŒĞ·Ñ:**

- âŒ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ `orchestrator`
- âŒ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ `api-client`
- âŒ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ `validatedEffect`

**ğŸ’¡ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ?**
Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑÑ **Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ**: `feature â†’ infra â†’ feature`

**âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°:**

```
session-manager
  â†“
effects/refresh.ts (ÑƒĞ¶Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ orchestrator)
  â†“
app/lib/orchestrator.ts
```

---

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:** Ğ’ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹, Ğ½ĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ² transport/telemetry Ğ¸Ğ· effects, ESLint = 0 warnings

---

## ğŸ Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞ«Ğ™ ĞŸĞ Ğ˜ĞĞ¦Ğ˜ĞŸ

> âš ï¸ **ĞĞ˜ ĞĞ”Ğ˜Ğ effect Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½:**

- âŒ Ğ”ĞµĞ»Ğ°Ñ‚ÑŒ **inline timeout** â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `withTimeout`
- âŒ Ğ”ĞµĞ»Ğ°Ñ‚ÑŒ **inline validation** â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `validatedEffect`
- âŒ Ğ”ĞµĞ»Ğ°Ñ‚ÑŒ **inline isolation** â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `runIsolated`
- âŒ ĞŸÑ€Ğ¾Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ **ÑÑ‹Ñ€Ğ¾Ğ¹ API response** â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `validatedEffect`
- âŒ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ **store Ğ±ĞµĞ· safeSet** â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `safeSet`

---

## ğŸ“š Ğ¡Ğ’Ğ¯Ğ—ĞĞĞĞ«Ğ• Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢Ğ«

- ğŸ“„ `auth-implementation.md` â€” Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ auth
- ğŸ“„ `ui-architecture-decisions.md` â€” Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ UI
- ğŸ“„ `phase2-UI.md` â€” roadmap Phase 2

---

## âœ… ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡ĞĞĞ¢Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ¯ PHASE2-UI.MD

### Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ÑƒĞ¼ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸

| Ğ¤Ğ°Ğ¹Ğ»                         | Phase2-UI.md   | Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ                              |
| ---------------------------- | -------------- | --------- | ----------------------------------- |
| `effect-timeout.ts`          | 67 (NEW)       | 67 âœ…     | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `effect-isolation.ts`        | 68 (NEW)       | 68 âœ…     | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `schema-validated-effect.ts` | 69 (NEW)       | 69 âœ…     | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `orchestrator.ts`            | 70 (NEW)       | 70 âœ…     | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `store-utils.ts`             | 68.1 (NEW)     | 71 âœ…     | âš ï¸ ĞÑƒĞ¼ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ (Ğ½Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾) |
| `login.ts`                   | 155 (REFACTOR) | 155 âœ…    | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `device-fingerprint.ts`      | 155.1 (NEW)    | 155.1 âœ…  | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `risk-assessment.ts`         | 155.2 (NEW)    | 155.2 âœ…  | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `error-mapper.ts`            | 155.3 (NEW)    | 155.3 âœ…  | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `helpers.ts`                 | 155.4 (NEW)    | 155.4 âœ…  | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |
| `security-pipeline.ts`       | 158.1 (NEW)    | 158.1 âœ…  | âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚                    |

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

**âœ… Ğ’ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾:**

- ĞŸÑƒÑ‚Ğ¸ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (`lib/`, `domain/`, `types/`)
- ĞšĞ¾Ğ´-ÑÑ‚ĞµĞº ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ²ĞµÑ€Ğ½Ğ¾ (`ts+effect` Ğ´Ğ»Ñ effects, `ts` Ğ´Ğ»Ñ pure functions)
- ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼Ñƒ ĞºĞ¾Ğ´Ñƒ
- ĞĞµÑ‚ Ñ†Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

**âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼Ñƒ ĞºĞ¾Ğ´Ñƒ:**

- `login.ts` Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `api-client`, `error-mapping`, `telemetry` (Ğ±ÑƒĞ´ĞµÑ‚ ÑƒĞ±Ñ€Ğ°Ğ½Ğ¾)
- `schemas.ts` ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² `feature-auth/src/` (Ğ½Ğµ `schemas/login.schema.ts`)
- `effect-utils.ts` ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ `Effect`, `EffectContext`, `withTimeout`, `withRetry`, `withLogging`
- `api-client.ts` Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `effect-utils.ts` Ğ¸ `telemetry.ts`

### âš ï¸ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

#### 1ï¸âƒ£ ĞĞµÑ‚ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ isolation

**âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ:**

- âœ… **orchestrator** â€” ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ Ğ¼ĞµÑÑ‚Ğ¾ `runIsolated` (Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº)
- âœ… **validatedEffect** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ + throw DomainError (ĞĞ• Ğ´ĞµĞ»Ğ°ĞµÑ‚ isolation)
- âœ… **api-client** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ transport + throw Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ (ĞĞ• Ğ´ĞµĞ»Ğ°ĞµÑ‚ isolation)

**âŒ ĞĞ• Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾:**

- âŒ Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ try/catch (validatedEffect + orchestrator)
- âŒ Swallowing Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ² validatedEffect
- âŒ Isolation Ğ½Ğ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… ÑƒÑ€Ğ¾Ğ²Ğ½ÑÑ…

**âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:**

- `validatedEffect` ĞĞ• Ğ¾Ğ±Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ² try/catch
- `validatedEffect` Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸ Ğ±Ñ€Ğ¾ÑĞ°ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
- `orchestrator` ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ»Ğ°ĞµÑ‚ `runIsolated`

---

#### 2ï¸âƒ£ Refresh idempotency guard

**âœ… ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ refresh.ts:**

- âœ… **Idempotency guard** â€” Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
- âœ… **Mutex Ğ¸Ğ»Ğ¸ state check** â€” Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ³Ğ¾Ğ½ĞºĞ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹
- âœ… **Ğ§ĞµÑ€ĞµĞ· orchestrator** â€” ĞºĞ°Ğº Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ step

**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**

1. **Ğ§ĞµÑ€ĞµĞ· orchestrator step:**
   ```typescript
   orchestrate([
     step('idempotency-check', checkIfAlreadyRefreshing),
     step('refresh-api', refreshApiCall),
   ]);
   ```

2. **Ğ§ĞµÑ€ĞµĞ· ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ mutex:**
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `refreshMutex` Ğ¸Ğ· `auth-service.ts`
   - ĞĞ±ĞµÑ€Ğ½ÑƒÑ‚ÑŒ refresh effect Ğ² mutex guard

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:**

- ĞĞµÑ‚ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… refresh Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
- ĞĞµÑ‚ Ğ³Ğ¾Ğ½ĞºĞ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹
- ĞĞµÑ‚ ĞºĞ°ÑĞºĞ°Ğ´Ğ½Ñ‹Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¿Ñ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… refresh

---

#### 3ï¸âƒ£ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿ÑƒÑ‚ĞµĞ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²

**âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµÑ€ĞµĞ· app/):**

```typescript
// âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
import { orchestrator } from '@livai/app/lib/orchestrator.js';
import { validatedEffect } from '@livai/app/lib/schema-validated-effect.js';

// âŒ ĞĞ• Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
import { orchestrator } from '../../app/lib/orchestrator.js';
import { apiClient } from '@livai/app/lib/api-client.js'; // Ğ² effects
```

**âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹:**

- Ğ’ÑĞµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ¸Ğ· `app/lib` Ñ‡ĞµÑ€ĞµĞ· package name (`@livai/app`)
- ĞĞµÑ‚ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿ÑƒÑ‚ĞµĞ¹ Ñ‡ĞµÑ€ĞµĞ· `../../`
- ĞĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ² `api-client` Ğ¸Ğ· feature effects

---

**ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€:** AI Assistant\
**ğŸ“… ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 2026-01\
**âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾:** Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ phase2-UI.md Ğ¸ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼Ñƒ ĞºĞ¾Ğ´Ñƒ
