# Pipeline Runbook

**Production incident guide.** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏, —Ä–æ—Å—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö provider.

---

## üî¥ Universal Emergency Rollback

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –ª—é–±–æ–º —Å–µ—Ä—å—ë–∑–Ω–æ–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ.**

```bash
export FORCE_PIPELINE_V1=1
export DISABLE_REMOTE_PROVIDER=1   # –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å.

**–≠—Ç–æ:**

- –æ—Ç–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –ø–∞–π–ø–ª–∞–π–Ω–∞
- –æ—Ç–∫–ª—é—á–∞–µ—Ç —É–¥–∞–ª—ë–Ω–Ω—ã–π provider (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)

---

## üö¶ Go / No-Go Thresholds

**–ú–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ—à–µ–Ω–∏—è:** ‚â• 1000 —Å—Ä–∞–≤–Ω–µ–Ω–∏–π

- **`newVersionWeakerPercentage`**
  - üü¢ –ù–æ—Ä–º–∞: < 0.3%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 1% ‚Üí rollback

- **`providerTimeoutRate`**
  - üü¢ –ù–æ—Ä–º–∞: < 1%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 5% ‚Üí disable provider

- **`failClosedRate`**
  - üü¢ –ù–æ—Ä–º–∞: baseline +20%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: baseline +50% ‚Üí rollback

- **`circuitBreakerOpen %`**
  - üü¢ –ù–æ—Ä–º–∞: < 5%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 15% ‚Üí disable provider

**–ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ –ª—é–±–æ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç—å Universal Emergency Rollback**

---

## üö® Incident Scenarios

### 1Ô∏è‚É£ –ú–∞—Å—Å–æ–≤—ã–π fail-closed

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**

- `failClosedRate > baseline +50%`
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏—è:**

1. Universal Emergency Rollback
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `providerTimeoutRate`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å circuit breaker
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å provider

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** `failClosedRate` –≤–µ—Ä–Ω—É–ª—Å—è –∫ baseline

---

### 2Ô∏è‚É£ Provider outage / —Ç–∞–π–º–∞—É—Ç—ã

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**

- `providerTimeoutRate > 5%`
- circuit breaker —á–∞—Å—Ç–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `open`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. `export DISABLE_REMOTE_PROVIDER=1`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
3. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç ‚Üí Universal Emergency Rollback

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** `providerTimeoutRate < 1%`, breaker —Å—Ç–∞–±–∏–ª–µ–Ω

---

### 3Ô∏è‚É£ –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å–ª–∞–±–µ–µ (regression)

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**

- `newVersionWeakerPercentage > 1%`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. Universal Emergency Rollback
2. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
3. –û—Ç–∫—Ä—ã—Ç—å bug —Å comparison snapshot
4. –ù–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å rollout –ø—Ä–∏ regression > 1%

---

### 4Ô∏è‚É£ –ú–∞—Å—Å–æ–≤–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**

- —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç deny
- —Ä–æ—Å—Ç support-—Ç–∏–∫–µ—Ç–æ–≤
- —Ä–æ—Å—Ç `failClosedRate`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. Universal Emergency Rollback
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ª–∏–º–∏—Ç–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å provider-–æ—Ç–≤–µ—Ç—ã

---

## üîß Runtime Overrides

- **`FORCE_PIPELINE_V1=1`**
  - –≠—Ñ—Ñ–µ–∫—Ç: –ü–æ–ª–Ω—ã–π rollback –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é pipeline
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –ü—Ä–∏ –ª—é–±–æ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ

- **`DISABLE_REMOTE_PROVIDER=1`**
  - –≠—Ñ—Ñ–µ–∫—Ç: –û—Ç–∫–ª—é—á–∏—Ç—å remote provider, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ local rules
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å provider –∏–ª–∏ network

- **`PIPELINE_SHADOW_MODE=1`**
  - –≠—Ñ—Ñ–µ–∫—Ç: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä–µ—à–µ–Ω–∏—è
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –î–ª—è dry-run –∏ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫

---

## üìé –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `pipeline-rollout-plan.md` ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è rollout
- `pipeline-architecture.md` ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `pipeline-metrics.md` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

---

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ï—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç–µ—Å—å ‚Äî rollback –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —á–µ–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç.
