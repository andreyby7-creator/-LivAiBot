# üõ°Ô∏è Security Pipeline Runbook

**–í–µ—Ä—Å–∏—è:** 1.0\
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026\
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ:** Security Team, On-Call Engineers

---

## üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (30 —Å–µ–∫—É–Ω–¥)

### –û—Ç–∫–ª—é—á–∏—Ç—å v2 –ø–æ–ª–Ω–æ—Å—Ç—å—é (–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ v1)

**–ß–µ—Ä–µ–∑ environment variable:**

```bash
export FORCE_RISK_V1=1
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
```

**–ß–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```typescript
const config: SecurityPipelineConfig = {
  // ...
  rolloutConfig: {
    shadowV2TrafficPercentage: 0,
    activeV2TrafficPercentage: 0,
    v2EnabledTenants: [],
    v2EnabledBuckets: [],
  },
};
```

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** < 30 —Å–µ–∫—É–Ω–¥\
**–í–ª–∏—è–Ω–∏–µ:** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ v1, v2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–µ–Ω

---

## üìä –ß—Ç–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### 1. Disagreement Dashboard

**–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å:** `security-pipeline.metrics.ts` ‚Üí `DisagreementDashboardMetrics`

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:**

- `v2WeakerPercentage` ‚Äî **–°–ê–ú–ê–Ø –í–ê–ñ–ù–ê–Ø** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ v2 —Å–ª–∞–±–µ–µ v1
  - üü¢ –ù–æ—Ä–º–∞: < 0.3%
  - üü° –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: 0.3% - 1%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 1% ‚Üí **–ù–ï–ú–ï–î–õ–ï–ù–ù–´–ô –û–¢–ö–ê–¢**
- `v2StricterPercentage` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ v2 —Å—Ç—Ä–æ–∂–µ v1
  - –ù–æ—Ä–º–∞: –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—ç—Ç–æ —Ö–æ—Ä–æ—à–æ)
- `exactMatchPercentage` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
  - –ù–æ—Ä–º–∞: > 95%
- `totalComparisons` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
  - –ú–∏–Ω–∏–º—É–º –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è: 1000

**–ö–∞–∫ —á–∏—Ç–∞—Ç—å:**

```typescript
// –ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫
{
  totalComparisons: 10000,
  v2WeakerPercentage: 0.15,  // ‚úÖ –•–æ—Ä–æ—à–æ
  v2StricterPercentage: 2.5, // ‚úÖ –•–æ—Ä–æ—à–æ
  exactMatchPercentage: 97.35, // ‚úÖ –•–æ—Ä–æ—à–æ
  averageScoreDelta: 1.2,     // ‚úÖ –ù–µ–±–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞
  v2WeakerCount: 15,          // ‚úÖ –ù–∏–∑–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
}
```

#### 2. Provider Metrics

**–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å:** `security-pipeline.circuit-breaker.ts` ‚Üí `CircuitBreakerStateWithMetrics`

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:**

- `providerTimeoutRate` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤ remote provider
  - üü¢ –ù–æ—Ä–º–∞: < 1%
  - üü° –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: 1% - 5%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 5% ‚Üí **–û–¢–ö–õ–Æ–ß–ò–¢–¨ REMOTE PROVIDER**
- `failClosedRate` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ª—É—á–∞–µ–≤ fail-closed
  - üü¢ –ù–æ—Ä–º–∞: < baseline + 20%
  - üü° –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: baseline + 20% - 50%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > baseline + 50% ‚Üí **–ü–†–û–í–ï–†–ò–¢–¨ –ü–†–û–í–ê–ô–î–ï–†**
- `circuit breaker open %` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
  - üü¢ –ù–æ—Ä–º–∞: < 5%
  - üü° –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: 5% - 15%
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 15% ‚Üí **–û–¢–ö–õ–Æ–ß–ò–¢–¨ REMOTE PROVIDER**

**–ö–∞–∫ —á–∏—Ç–∞—Ç—å:**

```typescript
// –ü—Ä–∏–º–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è circuit breaker
{
  state: 'closed',           // ‚úÖ –•–æ—Ä–æ—à–æ
  successCount: 9500,
  failureCount: 500,
  errorsInWindow: 45,        // ‚úÖ –í –ø—Ä–µ–¥–µ–ª–∞—Ö error budget (100)
  errorBudgetWindowStart: Date.now() - 120000, // ‚úÖ –û–∫–Ω–æ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ
}
```

---

## üö® –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–∞—Å—Å–æ–≤—ã–π fail-closed

**–°–∏–º–ø—Ç–æ–º—ã:**

- `failClosedRate` —Ä–µ–∑–∫–æ –≤—ã—Ä–æ—Å (> baseline + 50%)
- –ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö: `[security-pipeline] fail-closed triggered`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏

**–î–µ–π—Å—Ç–≤–∏—è (–ø–æ –ø–æ—Ä—è–¥–∫—É):**

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (0-1 –º–∏–Ω—É—Ç–∞):**
   ```bash
   export FORCE_RISK_V1=1
   export DISABLE_REMOTE_PROVIDER=1
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (1-2 –º–∏–Ω—É—Ç—ã):**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `providerTimeoutRate`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `circuit breaker state`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ remote provider

3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (2-5 –º–∏–Ω—É—Ç):**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å remote provider
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å network connectivity
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å rate limits

4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ remote provider ‚Üí –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ network ‚Üí –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –≤–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ ‚Üí –æ—Ç–∫–∞—Ç–∏—Ç—å deployment

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** `failClosedRate` –≤–µ—Ä–Ω—É–ª—Å—è –∫ baseline

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Provider outage

**–°–∏–º–ø—Ç–æ–º—ã:**

- `circuit breaker state = 'open'`
- `providerTimeoutRate = 100%`
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ remote provider —Ç–∞–π–º–∞—É—Ç—è—Ç

**–î–µ–π—Å—Ç–≤–∏—è:**

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (0-30 —Å–µ–∫—É–Ω–¥):**
   ```bash
   export DISABLE_REMOTE_PROVIDER=1
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å (1 –º–∏–Ω—É—Ç–∞):**
   - Pipeline –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ local rules
   - `failClosedRate` –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–∞

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏ local rules
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ `v2WeakerPercentage` (–º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ –±–µ–∑ remote provider)

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**

- –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è provider ‚Üí –≤–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ canary
- –ù–∞—á–∞—Ç—å —Å 1% —Ç—Ä–∞—Ñ–∏–∫–∞, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: v2 weaker than v1 > threshold

**–°–∏–º–ø—Ç–æ–º—ã:**

- `v2WeakerPercentage > 0.3%` (go/no-go –ø–æ—Ä–æ–≥)
- `v2WeakerCount` —Ä–∞—Å—Ç–µ—Ç
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–µ–π—Å—Ç–≤–∏—è:**

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (0-30 —Å–µ–∫—É–Ω–¥):**
   ```bash
   export FORCE_RISK_V1=1
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
   ```

2. **–ê–Ω–∞–ª–∏–∑ (5-15 –º–∏–Ω—É—Ç):**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ risk rules
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ remote provider
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ aggregation policy

3. **–†–µ—à–µ–Ω–∏–µ:**
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö ‚Üí –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ provider ‚Üí –æ—Ç–∫–ª—é—á–∏—Ç—å provider
   - –ï—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ ‚Üí –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ v1 –¥–æ –≤—ã—è—Å–Ω–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** `v2WeakerPercentage < 0.3%` –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ú–∞—Å—Å–æ–≤–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ª–µ–≥–∏—Ç–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°–∏–º–ø—Ç–æ–º—ã:**

- –†–µ–∑–∫–∏–π —Ä–æ—Å—Ç –∂–∞–ª–æ–± –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `v2StricterPercentage` –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π (> 10%)
- –ú–Ω–æ–≥–æ false positives

**–î–µ–π—Å—Ç–≤–∏—è:**

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (0-1 –º–∏–Ω—É—Ç–∞):**
   ```bash
   export FORCE_RISK_V1=1
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
   ```

2. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (1-5 –º–∏–Ω—É—Ç):**
   - –í–∫–ª—é—á–∏—Ç—å `FAIL_OPEN_MODE=1` (—Ç–æ–ª—å–∫–æ –¥–ª—è emergency)
   - –ò–õ–ò —Å–Ω–∏–∑–∏—Ç—å `activeV2TrafficPercentage` –¥–æ 0%

3. **–ê–Ω–∞–ª–∏–∑:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ risk rules
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ scoring
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ aggregation policy

4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ replay dataset
   - –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ canary

---

## üîß –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/tenant

**–ß–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```typescript
const config: SecurityPipelineConfig = {
  // ...
  rolloutConfig: {
    // –û—Ç–∫–ª—é—á–∏—Ç—å v2 –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ tenant
    v2EnabledTenants: [], // –£–±—Ä–∞—Ç—å tenant –∏–∑ —Å–ø–∏—Å–∫–∞
    // –ò–õ–ò –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ user bucket
    v2EnabledBuckets: [], // –£–±—Ä–∞—Ç—å bucket –∏–∑ —Å–ø–∏—Å–∫–∞
  },
};
```

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** < 1 –º–∏–Ω—É—Ç–∞ (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)

---

### –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ shadow mode

**–ß–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```typescript
const config: SecurityPipelineConfig = {
  // ...
  rolloutConfig: {
    shadowV2TrafficPercentage: 100, // 100% shadow mode
    activeV2TrafficPercentage: 0, // 0% active mode
  },
};
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

- –î–ª—è dry-run: `shadowV2TrafficPercentage: 100`
- –î–ª—è canary: –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `activeV2TrafficPercentage`

---

## üìà Go/No-Go –∫—Ä–∏—Ç–µ—Ä–∏–∏

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è active_v2

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (–í–°–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã):**

1. ‚úÖ `v2WeakerPercentage < 0.3%` (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞)
2. ‚úÖ `providerTimeoutRate < 1%` (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞)
3. ‚úÖ `failClosedRate < baseline + 20%` (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞)
4. ‚úÖ `circuit breaker open % < 5%` (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞)
5. ‚úÖ `totalComparisons >= 10000` (–º–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö)
6. ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 48 —á–∞—Å–æ–≤

**–ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Üí –ù–ï –≤–∫–ª—é—á–∞—Ç—å active_v2**

---

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–∞ canary

**–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1% ‚Üí 5%):**

1. ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –Ω–æ—Ä–º–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
2. ‚úÖ `v2WeakerPercentage` —Å—Ç–∞–±–∏–ª—å–Ω–æ < 0.3%
3. ‚úÖ –ù–µ—Ç —Ä–æ—Å—Ç–∞ `failClosedRate`
4. ‚úÖ –ù–µ—Ç –∂–∞–ª–æ–± –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Üí –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç**

---

## üîÑ Canary Rollout –ø–ª–∞–Ω

### –≠—Ç–∞–ø—ã rollout

1. **Shadow mode (100%)** ‚Äî 24-72 —á–∞—Å–∞
   - –¢–æ–ª—å–∫–æ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
   - –ù–∏–∫–∞–∫–æ–≥–æ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä–µ—à–µ–Ω–∏—è

2. **Canary 1%** ‚Äî 24 —á–∞—Å–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–π —á–∞—Å
   - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –æ—Ç–∫–∞—Ç—É

3. **Canary 5%** ‚Äî 24 —á–∞—Å–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∂–∞–ª–æ–± –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

4. **Canary 20%** ‚Äî 48 —á–∞—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞
   - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

5. **Canary 50%** ‚Äî 48 —á–∞—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
   - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º rollout

6. **Canary 100%** ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
   - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ—Ç–∫–∞—Ç—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–ú–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏:** –º–∏–Ω–∏–º—É–º 24 —á–∞—Å–∞ –ø–∞—É–∑—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

## üõ†Ô∏è Runtime Overrides (On-Call Safety Switches)

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### `FORCE_RISK_V1=1`

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å v1 –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤\
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ v2\
**–í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è:** –î–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

#### `DISABLE_REMOTE_PROVIDER=1`

**–≠—Ñ—Ñ–µ–∫—Ç:** –û—Ç–∫–ª—é—á–∏—Ç—å remote risk provider, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ local rules\
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å provider –∏–ª–∏ network\
**–í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è:** –î–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

#### `FAIL_OPEN_MODE=1`

**–≠—Ñ—Ñ–µ–∫—Ç:** –í–∫–ª—é—á–∏—Ç—å fail-open —Ä–µ–∂–∏–º (—Ä–∞–∑—Ä–µ—à–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)\
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –¢–û–õ–¨–ö–û –¥–ª—è emergency —Å–∏—Ç—É–∞—Ü–∏–π\
**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –°–Ω–∏–∂–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞—è—Ö\
**–í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è:** –î–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

### –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
export FORCE_RISK_V1=1

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–≥–æ deployment)
# –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è Docker:
docker restart auth-service

# –ò–õ–ò –¥–ª—è Kubernetes:
kubectl set env deployment/auth-service FORCE_RISK_V1=1
kubectl rollout restart deployment/auth-service
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**Security Team:** security@example.com\
**On-Call Engineer:** oncall@example.com\
**Escalation:** security-lead@example.com

---

## üìù Changelog

- **2026-XX-XX:** –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è runbook
- **2026-XX-XX:** –î–æ–±–∞–≤–ª–µ–Ω—ã runtime overrides
- **2026-XX-XX:** –û–±–Ω–æ–≤–ª–µ–Ω—ã go/no-go –∫—Ä–∏—Ç–µ—Ä–∏–∏

---

**–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç runbook –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º on-call –∏–Ω–∂–µ–Ω–µ—Ä–∞–º –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Å–∏—Å—Ç–µ–º–µ.
