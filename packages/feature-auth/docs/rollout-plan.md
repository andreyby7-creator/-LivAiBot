# üöÄ Security Pipeline v2 Rollout Plan

**–í–µ—Ä—Å–∏—è:** 1.2\
**–°—Ç–∞—Ç—É—Å:** Operational\
**–¶–µ–ª—å:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ Security Pipeline v2 –≤ production.

> üìò **Generic rollout –ø—Ä–∏–Ω—Ü–∏–ø—ã:** [`@livai/core/docs/pipeline-rollout-plan.md`](../../core/docs/pipeline-rollout-plan.md)\
> **Runbook –¥–ª—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤:** `auth-risk-runbook.md`

---

## üìê –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- Rollout –≤—Å–µ–≥–¥–∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π.
- –õ—é–±–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤ ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π rollback.
- –ú–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ—à–µ–Ω–∏—è: ‚â• 10,000 —Å—Ä–∞–≤–Ω–µ–Ω–∏–π.
- –ú–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ ‚Äî –º–∏–Ω–∏–º—É–º 24 —á–∞—Å–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.
- –ü–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ —ç—Ç–∞–ø –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –∞ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.

---

## üìä –§–æ—Ä–º–∞–ª—å–Ω—ã–µ Go / No-Go –ø—Ä–∞–≤–∏–ª–∞

**–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø –í–°–ï —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞):**

- `v2WeakerPercentage < 0.3%`
- `providerTimeoutRate < 1%`
- `failClosedRate < baseline + 20%`
- `circuitBreakerOpen % < 5%`
- `totalComparisons ‚â• 10,000`
- –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

**–ï—Å–ª–∏ –ª—é–±–æ–µ —É—Å–ª–æ–≤–∏–µ –Ω–∞—Ä—É—à–µ–Ω–æ ‚Üí –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ rollout –∏–ª–∏ –æ—Ç–∫–∞—Ç.**

---

## üìã –≠—Ç–∞–ø—ã Rollout

### –≠—Ç–∞–ø 0 ‚Äî Shadow (100%)

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 24‚Äì72 —á–∞—Å–∞

```typescript
rolloutConfig: {
  shadowV2TrafficPercentage: 100,
  activeV2TrafficPercentage: 0,
}
```

**–¶–µ–ª—å:** –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ baseline –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä–µ—à–µ–Ω–∏—è.

**–ü–µ—Ä–µ—Ö–æ–¥ –¥–∞–ª–µ–µ** ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Go / No-Go –ø—Ä–∞–≤–∏–ª.

---

### –≠—Ç–∞–ø 1 ‚Äî Canary 1%

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 24 —á–∞—Å–∞

```typescript
rolloutConfig: {
  shadowV2TrafficPercentage: 99,
  activeV2TrafficPercentage: 1,
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –∫–∞–∂–¥—ã–π —á–∞—Å.

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ 5%** ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ Go / No-Go.

---

### –≠—Ç–∞–ø 2 ‚Äî Canary 5%

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 24 —á–∞—Å–∞

```typescript
rolloutConfig: {
  shadowV2TrafficPercentage: 95,
  activeV2TrafficPercentage: 5,
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞.

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ 20%** ‚Äî –ø–æ—Å–ª–µ 24 —á–∞—Å–æ–≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

### –≠—Ç–∞–ø 3 ‚Äî Canary 20%

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 48 —á–∞—Å–æ–≤

```typescript
rolloutConfig: {
  shadowV2TrafficPercentage: 80,
  activeV2TrafficPercentage: 20,
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞.

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ 50%** ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ 48 —á–∞—Å–æ–≤.

---

### –≠—Ç–∞–ø 4 ‚Äî Canary 50%

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 48 —á–∞—Å–æ–≤

```typescript
rolloutConfig: {
  shadowV2TrafficPercentage: 50,
  activeV2TrafficPercentage: 50,
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤.

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ 100%** ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏.

---

### –≠—Ç–∞–ø 5 ‚Äî 100% Rollout

```typescript
rolloutConfig: {
  shadowV2TrafficPercentage: 0,
  activeV2TrafficPercentage: 100,
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–π –Ω–µ–¥–µ–ª–∏.

**Rollout —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º** –ø–æ—Å–ª–µ 7 –¥–Ω–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

## üö® –û—Ç–∫–∞—Ç

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç (–∫—Ä–∏—Ç–∏—á–Ω—ã–π)

```bash
export FORCE_RISK_V1=1
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏:**

- `v2WeakerPercentage ‚â• 0.3%`
- –ú–∞—Å—Å–æ–≤–æ–º fail-closed
- Provider outage
- –õ—é–±–æ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º security-–∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ

---

### –ß–∞—Å—Ç–∏—á–Ω—ã–π –æ—Ç–∫–∞—Ç

```bash
export DISABLE_REMOTE_PROVIDER=1
```

–ò–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å `activeV2TrafficPercentage` –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç—Ç–∞–ø–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏** –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Ç–æ–ª—å–∫–æ —Å provider.

---

## üîê Auth-specific Integration

Security Pipeline v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç generic pipeline –∏–∑ `@livai/core` —Å auth-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

```typescript
import { createPipelineConfig } from '@livai/core/pipeline';

const config = createPipelineConfig({
  rolloutConfig: {
    shadowV2TrafficPercentage: 100,
    activeV2TrafficPercentage: 0,
    v2EnabledTenants: [],
    v2EnabledBuckets: [],
  },
});
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

- `FORCE_RISK_V1=1` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ v1
- `DISABLE_REMOTE_PROVIDER=1` ‚Äî –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ remote provider
- `FAIL_OPEN_MODE=1` ‚Äî emergency —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –æ–¥–æ–±—Ä–µ–Ω–∏–∏ Security Lead)

---

## ‚è∏Ô∏è –ü–∞—É–∑—ã –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏

- **–ú–∏–Ω–∏–º—É–º 24 —á–∞—Å–∞** —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–æ 12 —á–∞—Å–æ–≤** –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏:
  - –∏–¥–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫–∞—Ö
  - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
  - –æ–¥–æ–±—Ä–µ–Ω–∏–∏ Security Lead

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç–∞

- [ ] –í—Å–µ Go / No-Go —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- [ ] On-call –∏–Ω–∂–µ–Ω–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Rollback –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [ ] Security Lead —É–≤–µ–¥–æ–º–ª—ë–Ω

---

## üîÑ –ü–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π rollback
2. Root cause analysis
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ replay dataset
5. –ü–æ–≤—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞

---

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Security Team\
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-XX-XX
