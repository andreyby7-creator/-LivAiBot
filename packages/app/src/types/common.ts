/**
 * @file packages/app/src/types/common.ts
 *
 * ============================================================================
 * üß± –û–ë–©–ò–ï –¢–ò–ü–´ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
 * ============================================================================
 *
 * –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ:
 * - –ù–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (auth, bots, chat –∏ —Ç.–¥.)
 * - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ–º–∏ feature-–ø–∞–∫–µ—Ç–∞–º–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º–∏ —Å–ª–æ—è–º–∏
 * - –ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
 * - –£—Å—Ç–æ–π—á–∏–≤—ã –∫ —Ä–æ—Å—Ç—É —Å–∏—Å—Ç–µ–º—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é –Ω–∞ –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
 *
 * –ü—Ä–∏–Ω—Ü–∏–ø—ã:
 * - –ú–∏–Ω–∏–º—É–º —Å–≤—è–∑–µ–π
 * - –ú–∞–∫—Å–∏–º—É–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
 * - –ß—ë—Ç–∫–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞
 */

/* ========================================================================== */
/* üîë –ë–ê–ó–û–í–´–ï –£–¢–ò–õ–ò–¢–ê–†–ù–´–ï –¢–ò–ü–´ */
/* ========================================================================== */

/**
 * –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—É—â–Ω–æ—Å—Ç–∏ —Å –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–º —Ç–∏–ø–æ–≤.
 * –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø—É—Ç—ã–≤–∞–Ω–∏–µ ID —Ä–∞–∑–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
 *
 * @example
 * export type UserID = ID<"UserID">;
 * export type BotID = ID<"BotID">;
 * export type ConversationID = ID<"ConversationID">;
 */
export type ID<T extends string = string> = string & { __brand: T; };

/**
 * ISO-8601 —Å—Ç—Ä–æ–∫–∞ –¥–∞—Ç—ã.
 * –ü—Ä–∏–º–µ—Ä: "2026-01-16T12:34:56.000Z"
 */
export type ISODateString = string;

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π JSON-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ç–∏–ø.
 * –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, payload'–æ–≤ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
 */
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json; }
  | Json[];

/**
 * Nullable helper.
 */
export type Nullable<T> = T | null;

/**
 * Optional helper.
 */
export type Optional<T> = T | undefined;

/**
 * Readonly helper.
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö DTO.
 */
export type Immutable<T> = {
  readonly [K in keyof T]: T[K];
};

/* ========================================================================== */
/* üåç –ü–õ–ê–¢–§–û–†–ú–ï–ù–ù–´–ï –¢–ò–ü–´ */
/* ========================================================================== */

/**
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∫–ª–∏–µ–Ω—Ç–∞.
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç feature-–ø–∞–∫–µ—Ç–∞–º –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–¥ —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
 */
export type Platform = 'web' | 'pwa' | 'mobile' | 'admin';

/**
 * –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
 * –ú–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è –≤ –±—É–¥—É—â–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è A/B —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ tenant-—Ä–µ–∂–∏–º–∞).
 */
export type AppContext = {
  platform: Platform;
  locale: string;
  timezone?: string;
};

/* ========================================================================== */
/* üì¶ –ë–ê–ó–û–í–´–ï –ö–û–ù–¢–†–ê–ö–¢–´ –î–õ–Ø –ú–ò–ö–†–û–°–ï–†–í–ò–°–û–í */
/* ========================================================================== */

/**
 * –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –≤—Å–µ—Ö API DTO.
 * –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ/–≤—ã—Ö–æ–¥–Ω—ã–µ –º–æ–¥–µ–ª–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –¥–æ–ª–∂–Ω—ã –µ–≥–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å.
 */
export type BaseDTO = {
  /** –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞ */
  id: ID;

  /** –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤ ISO —Ñ–æ—Ä–º–∞—Ç–µ */
  createdAt: ISODateString;

  /** –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
  updatedAt?: ISODateString;
};

/**
 * –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ API.
 */
export type PaginatedResponse<T> = {
  items: T[];
  total: number;
  limit: number;
  offset: number;
};

/**
 * –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ API –æ—Ç–≤–µ—Ç–∞ —Å –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏–µ–π.
 * –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (success=true –±–µ–∑ data).
 *
 * @example
 * const response: ApiResponse<User[]> =
 *   { success: true, data: users, meta: { total: 100 } } |
 *   { success: false, error: apiError, meta: { traceId: "abc" } };
 */
export type ApiResponse<T> =
  | { success: true; data: T; meta?: Json; }
  | { success: false; error: ApiError; meta?: Json; };

/* ========================================================================== */
/* ‚ùå –û–®–ò–ë–ö–ò –ò –°–û–°–¢–û–Ø–ù–ò–Ø */
/* ========================================================================== */

/**
 * –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫.
 * –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å backend-–∫–æ–¥–∞–º–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.
 */
export type ErrorCategory =
  | 'VALIDATION'
  | 'AUTH'
  | 'PERMISSION'
  | 'NOT_FOUND'
  | 'CONFLICT'
  | 'RATE_LIMIT'
  | 'INTERNAL';

/**
 * –ò—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–∫–∏ –¥–ª—è distributed tracing.
 */
export type ErrorSource = 'CLIENT' | 'GATEWAY' | 'SERVICE';

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ API —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π distributed tracing.
 */
export type ApiError = {
  /** –ú–∞—à–∏–Ω–Ω–æ-–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–π –∫–æ–¥ */
  code: string;

  /** –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ—à–∏–±–∫–∏ */
  category: ErrorCategory;

  /** –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ */
  message: string;

  /** –ò—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–∫–∏ –¥–ª—è observability */
  source?: ErrorSource;

  /** Trace ID –¥–ª—è distributed tracing */
  traceId?: string;

  /** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
  details?: Json;
};

/**
 * –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ store, hooks –∏ UI.
 */
export type AsyncStatus = 'idle' | 'loading' | 'success' | 'error';

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Å –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏–µ–π.
 * –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (success –±–µ–∑ data, error –±–µ–∑ error).
 *
 * @example
 * const state: AsyncState<User> =
 *   { status: "idle" } |
 *   { status: "loading" } |
 *   { status: "success"; data: user } |
 *   { status: "error"; error: apiError };
 */
export type AsyncState<T> =
  | { status: 'idle'; }
  | { status: 'loading'; }
  | { status: 'success'; data: T; }
  | { status: 'error'; error: ApiError; };

/* ========================================================================== */
/* üîÅ EVENT-DRIVEN –ò REALTIME */
/* ========================================================================== */

/**
 * –¢–∏–ø —Å–æ–±—ã—Ç–∏—è, –ø—Ä–∏—Ö–æ–¥—è—â–µ–≥–æ –ø–æ WebSocket/SSE —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º.
 *
 * @example
 * RealtimeEvent<"CHAT_MESSAGE", Message>
 * RealtimeEvent<"USER_JOINED", { userId: UserID }>
 */
export type RealtimeEvent<TType extends string = string, TPayload = Json> = {
  /** –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è */
  type: TType;

  /** –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ */
  timestamp: ISODateString;

  /** Payload —Å–æ–±—ã—Ç–∏—è */
  payload: TPayload;
};

/**
 * –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è.
 */
export type Subscription = {
  channel: string;
  unsubscribe: () => void;
};

/* ========================================================================== */
/* üîí SECURITY & FEATURE FLAGS */
/* ========================================================================== */

/**
 * –ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è feature-auth –∏ api-client.
 */
export type AuthContext = {
  accessToken?: string;
  refreshToken?: string;
  isAuthenticated: boolean;
};

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç feature-—Ñ–ª–∞–≥–æ–≤.
 */
export type FeatureFlags = Record<string, boolean>;

/* ========================================================================== */
/* üß© UTILITY CONTRACTS */
/* ========================================================================== */

/**
 * –§—É–Ω–∫—Ü–∏—è –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
 */
export type VoidFn = () => void;

/**
 * –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º.
 */
export type Handler<T> = (value: T) => void;

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ç–∏–ø –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
 */
export type Identifiable = {
  id: ID;
};

/**
 * –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –ª–æ–≥–∏—Ä—É–µ–º—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
 */
export type Loggable = {
  toLog(): Json;
};
