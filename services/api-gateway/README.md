## api-gateway (каркас)

Этот сервис — единая HTTP-точка входа (CORS, rate limits, ingress вебхуков, health/ready проверки).

### Базовые заголовки (фиксируем “один раз”)

- **`X-Trace-Id`**: корреляция запросов/логов между сервисами.
  - Если заголовок не пришёл — gateway сгенерирует UUID.
  - Возвращается в каждом ответе.
- **`X-Operation-Id`**: строго уникальный идентификатор операции (идемпотентность/дедуп/ретраи).
  - Если заголовок не пришёл или невалидный — gateway сгенерирует UUID.
  - Возвращается в каждом ответе.

### Локальный запуск (dev)

Из корня репозитория:

```bash
source .venv/bin/activate
cd services/api-gateway
uvicorn src.main:app --reload --port 8000
```

Проверки:

- `GET http://localhost:8000/healthz`
- `GET http://localhost:8000/readyz`

`/healthz` отвечает только за “процесс жив”.
`/readyz` проверяет внешние зависимости (Postgres/Redis) и вернёт `503`, если они недоступны (в режиме strict).

### Проксирование /v1/*

По умолчанию gateway запускается в режиме **stub** (возвращает `501`), чтобы каркас работал без downstream сервисов.

Чтобы включить прокси:

- `PROXY_ENABLED=true`
- `AUTH_SERVICE_URL=http://localhost:8001` (и другие `*_SERVICE_URL` по мере появления сервисов)
